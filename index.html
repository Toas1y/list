<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Price List Pro</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --bg: #000000; --card: #111111; --text: #ffffff; --blue: #2563eb; --green: #4ade80; --border: #333; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        header { width: 100%; max-width: 600px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        h1 { margin: 0; font-size: 1.4rem; font-weight: 800; letter-spacing: 1px; }
        .nav-btn { text-decoration: none; font-size: 1.2rem; background: #222; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; border: 1px solid var(--blue); }

        .controls { width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 12px; }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 0.75rem; color: #888; margin-bottom: 4px; margin-left: 4px; text-transform: uppercase; font-weight: bold; }
        
        select { background: var(--card); color: white; border: 1px solid var(--border); padding: 12px; font-size: 16px; border-radius: 8px; width: 100%; outline: none; -webkit-appearance: none; }
        select:focus { border-color: var(--blue); }
        select:disabled { opacity: 0.4; border-color: #222; }

        .result-card { background: #1a1a1a; width: 100%; max-width: 600px; margin-top: 25px; border-radius: 16px; padding: 20px; border: 1px solid var(--border); display: none; box-sizing: border-box; }
        
        .brand-badge { background: var(--blue); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .product-name { font-size: 1.4rem; margin: 12px 0 5px 0; font-weight: 700; color: white; }
        .product-details { color: #888; font-size: 0.85rem; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; line-height: 1.5; }
        
        .price-row { display: flex; justify-content: space-between; align-items: flex-end; }
        .price-box small { display: block; font-size: 0.7rem; color: #666; margin-bottom: 4px; }
        .sp { font-size: 2rem; font-weight: bold; color: var(--green); }
        .dp { font-size: 1.2rem; color: #888; font-family: monospace; }
        
        .profit { background: rgba(37,99,235,0.15); color: #60a5fa; padding: 8px; border-radius: 6px; text-align: center; margin-top: 15px; font-weight: 600; font-size: 0.9rem; }
        
        #status { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #444; }
    </style>
</head>
<body>
    <header>
        <h1>PRICE LIST PRO</h1>
        <a href="https://toas1y.github.io/size-calc/" class="nav-btn">ðŸ§®</a>
    </header>

    <div class="controls">
        <div class="input-group">
            <label>Brand</label>
            <select id="selBrand"><option value="">Loading...</option></select>
        </div>

        <div class="input-group">
            <label>Type / Category</label>
            <select id="selType" disabled><option>--</option></select>
        </div>

        <div class="input-group">
            <label>Product</label>
            <select id="selProduct" disabled><option>--</option></select>
        </div>

        <div class="input-group">
            <label>Series / Model</label>
            <select id="selSeries" disabled><option>--</option></select>
        </div>

        <div class="input-group">
            <label>Size</label>
            <select id="selSize" disabled><option>--</option></select>
        </div>

        <div class="input-group">
            <label>Thickness</label>
            <select id="selThickness" disabled><option>--</option></select>
        </div>
    </div>

    <div id="resultCard" class="result-card">
        <div><span class="brand-badge" id="resBrand">BRAND</span></div>
        <div class="product-name" id="resName">Product Name</div>
        <div class="product-details" id="resDetails">Details</div>
        
        <div class="price-row">
            <div class="price-box">
                <small>COST (DP)</small>
                <span class="dp" id="resDP">0</span>
            </div>
            <div class="price-box" style="text-align: right;">
                <small>SELL (SP)</small>
                <span class="sp" id="resSP">0</span>
            </div>
        </div>
        
        <div class="profit" id="resProfit">Profit</div>
    </div>
    
    <div id="status">...</div>

    <script>
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');

        let fullData = [];
        const sels = {
            brand: document.getElementById('selBrand'),
            type: document.getElementById('selType'),
            product: document.getElementById('selProduct'),
            series: document.getElementById('selSeries'),
            size: document.getElementById('selSize'),
            thickness: document.getElementById('selThickness')
        };
        const card = document.getElementById('resultCard');

        // Fetch Data
        fetch('data/prices.json').then(r => r.json()).then(data => {
            fullData = data;
            document.getElementById('status').innerText = "v2.0 Loaded";
            populate(sels.brand, [...new Set(data.map(i => i.brand))].sort());
        });

        function populate(el, items, placeholder = "-- Select --") {
            el.innerHTML = `<option value="">${placeholder}</option>`;
            // Filter out empty/null values from dropdowns
            items.filter(i => i).forEach(i => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.innerText = i;
                el.appendChild(opt);
            });
            el.disabled = false;
        }

        function resetBelow(level) {
            const order = ['brand', 'type', 'product', 'series', 'size', 'thickness'];
            const idx = order.indexOf(level);
            for (let i = idx + 1; i < order.length; i++) {
                sels[order[i]].innerHTML = '<option>--</option>';
                sels[order[i]].disabled = true;
            }
            card.style.display = 'none';
        }

        // --- Event Listeners --- //

        // 1. Brand -> Type
        sels.brand.addEventListener('change', () => {
            resetBelow('brand');
            const val = sels.brand.value;
            if (!val) return;
            const sub = fullData.filter(i => i.brand === val);
            populate(sels.type, [...new Set(sub.map(i => i.type))]);
        });

        // 2. Type -> Product
        sels.type.addEventListener('change', () => {
            resetBelow('type');
            const val = sels.type.value;
            if (!val) return;
            const sub = fullData.filter(i => i.brand === sels.brand.value && i.type === val);
            populate(sels.product, [...new Set(sub.map(i => i.product))]);
        });

        // 3. Product -> Series
        sels.product.addEventListener('change', () => {
            resetBelow('product');
            const val = sels.product.value;
            if (!val) return;
            const sub = fullData.filter(i => i.brand === sels.brand.value && i.type === sels.type.value && i.product === val);
            populate(sels.series, [...new Set(sub.map(i => i.series))]);
        });

        // 4. Series -> Size
        sels.series.addEventListener('change', () => {
            resetBelow('series');
            const val = sels.series.value;
            if (!val) return;
            const sub = fullData.filter(i => i.brand === sels.brand.value && i.type === sels.type.value && i.product === sels.product.value && i.series === val);
            populate(sels.size, [...new Set(sub.map(i => i.size))]);
        });

        // 5. Size -> Thickness
        sels.size.addEventListener('change', () => {
            resetBelow('size');
            const val = sels.size.value;
            if (!val) return;
            const sub = fullData.filter(i => i.brand === sels.brand.value && i.type === sels.type.value && i.product === sels.product.value && i.series === sels.series.value && i.size === val);
            populate(sels.thickness, [...new Set(sub.map(i => i.thickness))]);
        });

        // 6. Thickness -> RESULT
        sels.thickness.addEventListener('change', () => {
            const item = fullData.find(i => 
                i.brand === sels.brand.value && 
                i.type === sels.type.value && 
                i.product === sels.product.value && 
                i.series === sels.series.value && 
                i.size === sels.size.value && 
                i.thickness === sels.thickness.value
            );

            if (item) {
                const profit = item.sp - item.dp;
                document.getElementById('resBrand').innerText = item.brand;
                document.getElementById('resName').innerText = `${item.product} ${item.series}`;
                document.getElementById('resDetails').innerText = `${item.type} | ${item.size} | ${item.thickness}`;
                document.getElementById('resDP').innerText = `â‚¹${item.dp}`;
                document.getElementById('resSP').innerText = `â‚¹${item.sp}`;
                document.getElementById('resProfit').innerText = `Profit: â‚¹${profit}`;
                card.style.display = 'block';
            }
        });
    </script>
</body>
</html>
